---
layout: article
title:  "「CV」 图像相似度计算概述"
date:   2019-06-25 18:06:40 +0800
key: image-similarities-survey-20190625
aside:
  toc: true
category: [CV, retrival]
---
<span id='head'></span>  

>图像相似度计算是对两幅图像之间内容的相似程度进行打分；   
可用于*模板匹配*，进而应用到**检测**和**跟踪**中（根据已有模板，找到一个与之最接近的区域），比如 BlobTracking，Meanshift，Camshift，粒子滤波等；另一方方面，可用于基于图像内容的**图像检索**，也就是通常说的以图检图，通常的做法是抽取特征，比如 Trace变换，图像哈希或者 Sift 特征向量等，然后计算特征的距离；     

<!--more-->  

# 1 基于图像
## 1.1 峰值信噪比
>PSNR（Peak Signal to Noise Ratio）   
参考全图的图像质量评价指标；        

最常用的图像客观评价指标；    
**原理**：但是它是基于对应像素点间的误差，也就是基于误差敏感的图像质量评价；    
**特点**：并没有考虑人眼的视觉特征：   
  - 对空间频率较低的对比差异敏感度较高，
  - 对亮度对比差异的敏感度较色度高，
  - 对区域的感知结果受邻域影响等；
因此评价结果与人的主观常常不一致；    
**公式**：   
$$
\begin{align}
MSE &= {1 \over {H \times W}} \sum_{i = 1}^{H} \sum_{i = 1}^{W} (X_{i, j} - Y_{i, j})^2 \label{mse} \\   
PSNR &= 10 \log_{10} {(2^n -1)^2 \over {MSE}} \label{PSNR}
\end{align}
$$
注：$MSE$ 表示当前图像 $X$ 和参考图像 $Y$ 的均方误差（Mean Square Error），$H$、$W$ 分别为图像的高度和宽度；$n$ 为每像素的比特数，一般取 8，即像素灰阶数为 256；$PSNR$ 的单位是 dB，数值越大表示失真越小；    
`PSNR 为什么要这么定义啊`{:.warning}   

## 1.2 结构相似性
>SSIM（structural similarity）   
参考全图的图像质量评价指标；分别从亮度、对比度、结构三方面度量图像相似性；    

**公式**：    
$$
\begin{align}
l(X, Y) =& {2 \mu_X \mu_Y + C_1} \over {\mu_X^2 + \mu_Y^2 + C_1} \label{light} \\
c(X, Y) =& {2 \sigma_X \sigma_Y +C_2} \over {\sigma_X^2 + \sigma_Y^2 + C_2} \label{contrast}  \\
s(X, Y) =& {\sigma_{XY} + C_3} \over {\sigma_X \sigma_Y + C3} \label{structure} \\
SSIM(X, Y) &= l(X, Y) \cdot c(X, Y) \cdot s(X, Y) \label{SSIM}
\end{align}
$$
注：其中 $\mu_X, \mu_Y$ 分别表示图像 $X$ 和 $Y$ 的均值，$\sigma_X, \sigma_Y$ 分别表示图像 $X$ 和 $Y$ 的方差，$\sigma_{XY}$ 表示图像 $X$ 和 $Y$ 的协方差；$C_1、C_2、C_3$ 为常数，为了避免分母为 0 的情况，通常取 $C_1=(K_1 \times L)^2$, $C_2=(K_2 \times L)^2$, $C_3=C_2/2$, 一般地 $K_1=0.01, K_2=0.03, L=255$；       

SSIM取值范围[0,1]，值越大，表示图像失真越小；    

实际应用中，可以利用滑窗方式；考虑到窗口形状对分块的影响，采用高斯加权计算每一窗口的均值、方差以及协方差，然后计算对应块的结构相似度 SSIM，最后将平均值作为两图像的结构相似性度量，即平均结构相似性 MSSIM；   

## 1.3 直方图
**步骤**：计算图像的直方图——>取两个直方图的归一化相关系数（巴氏距离，直方图相交距离）；     
**缺点**：   
- 直方图反映的是像素灰度值的概率分布，而没有考虑位置关系（比如图像的骨架，物体形状）；很明显，一个上黑下白的图像和上白下黑的图像其直方图分布是一模一样的；    
- 距离度量采用的是巴氏距离或者归一化相关系数，这种用分析数学向量的方法去分析图像，本身就是一个很不好的办法；    
- 从信息量角度来看，用一个数值来衡量两幅图像的相似度，是一个信息压缩的过程，那么肯定就会存在不准确性；    

# 2 基于特征
## 2.1 感知哈希
>perceptual hash algorithm    
对每张图像生成一个「指纹」(fingerprint)字符串，然后比较不同图像的指纹；结果越接近，就说明图像越相似；    

**步骤**：缩小尺寸——>灰度级简化——>二值化——>计算哈希——>计算汉明距离；[详细说明]()   
**代码示例**：    



# 2 各种方法优劣对比

|  | PSNR | SSIM | 感知哈希 |   
| --- | --- | --- | --- |
| 优势 |  |  |  |
| 劣势 | 未考虑人眼特性 |  |  |


-------------------  
[End](#head)
{:.warning}  


# 附录
## A 参考资料
1. wangyaning. OpenCV进行图像相似度对比的几种办法[EB/OL]. <https://www.cnblogs.com/wangyaning/p/7854046.html>. 2017-11-17/2019-06-26.  
